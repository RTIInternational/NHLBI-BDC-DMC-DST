{% extends "base_generic.html" %}
{% block content %}
<h2 class="text-muted" style="text-align: center">Ticket Tracker</h2>

<div id="board" class="container">
  {% for status_idx, status_data in statuses.items %}
      <div class="board-section">
        <div class="board-section-header">
          <p class="h5">{{ status_data.name }}</p>
        </div>
        <div class="board-item">
        {% for issue in status_data.issues %}
            <div class="card m-2 custom-card">
              <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <strong>{{ issue.fields.parent.fields.summary }}  -  {{ issue.fields.summary }}</strong>
                </div>
                <div>
                  <button class="btn btn-lozenge">Details</button>
                </div>
              </div>
              <div class="card-body">
                <p class="card-text">{{ issue.fields.customfield_15203 }}</p>
                <p class="card-text">{{ issue.fields.customfield_15204 }}</p>
                <p class="card-text">{{ issue.fields.description }}</p>
                <!-- Subtasks section -->
                {% if issue.fields.subtasks %}
                  <div class="subtasks">
                    <ul class="subtask-list">
                      {% for subtask in issue.fields.subtasks %}
                        <li class="{% if subtask.fields.status.name == 'Not Required' %}subtask-not-required{% endif %}">
                          <input type="checkbox"
                            {% if subtask.fields.status.name == 'Done' or subtask.fields.status.name == 'Not Required' %}checked{% endif %}
                            disabled>
                          {% if subtask.fields.status.name == 'In Progress' %}
                            <b>{{ subtask.fields.summary }}</b>
                          {% else %}
                            {{ subtask.fields.summary }}
                          {% endif %}
                        </li>
                      {% endfor %}
                    </ul>
                  </div>
                {% endif %}
              </div>
              {% if issue.fields.subtasks %}
              <div class="card-footer {% if issue.last_updated_color %}{{ issue.last_updated_color }}{% endif %}"
                data-bs-toggle="tooltip" data-bs-placement="bottom" title="test {{ issue.labels }}">
                <p class="card-text">{{ issue.fields.labels }}</p>
              </div>
              {% endif %}
            </div>
        {% endfor %}
        </div>
      </div>
  {% endfor %}
</div>

{% if user.is_staff %}
<div class="row">
  <a href="/rejected" class="btn btn-cancel btn-md" role="button">View Rejected Tickets</a>
</div>
{% endif %}
{% endblock %}